<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ’° PayTogether - Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø±Ø¬ Ùˆ ØªØ³ÙˆÛŒÙ‡ Ú¯Ø±ÙˆÙ‡ÛŒ</title>

  <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ Vazirmatn -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Bootstrap RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- dayjs -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f9fafb;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .navbar {
      background-color: #198754; /* Ø±Ù†Ú¯ Ø³Ø¨Ø² PayTogether */
    }
    .navbar-brand, .nav-link {
      color: #fff !important;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    footer {
      background: #198754;
      color: white;
      padding: 1rem 0;
      text-align: center;
      margin-top: auto;
    }
    .btn-primary {
      border-radius: 1rem;
      background-color: #198754;
      border-color: #198754;
    }
    .btn-primary:hover {
      background-color: #157347;
    }
    .modal-content { border-radius: 1rem; }
    .toast-container {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      z-index: 1055;
    }
    @media (max-width: 768px) {
      .card { margin-bottom: 1rem; }
    }
    #login-page, #about-page, #contact-page {
      max-width: 500px;
      margin: 5rem auto;
    }
  </style>
</head>
<body>

  <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#" id="nav-home">ğŸ’° PayTogether</a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link active" href="#" id="nav-dashboard">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="nav-groups">Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="nav-about">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="nav-contact">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a></li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#" id="nav-account"><i class="fa fa-user"></i> Ø­Ø³Ø§Ø¨ Ù…Ù†</a></li>
          <li class="nav-item"><a class="nav-link text-warning" href="#" id="logoutBtn"><i class="fa fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
  <main class="container my-4 flex-grow-1">

    <!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
    <div id="login-page" class="card p-4 d-none">
      <h4 class="text-center mb-3">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ PayTogether</h4>
      <form id="loginForm">
        <div class="mb-3">
          <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
          <input type="text" class="form-control" id="loginUser" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
          <input type="password" class="form-control" id="loginPass" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">ÙˆØ±ÙˆØ¯</button>
        <div class="text-center mt-2">
          <a href="#" id="show-register">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨</a>
        </div>
      </form>
    </div>

    <!-- Ø«Ø¨Øª Ù†Ø§Ù… -->
    <div id="register-page" class="card p-4 d-none">
      <h4 class="text-center mb-3">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± PayTogether</h4>
      <form id="registerForm">
        <div class="mb-3">
          <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
          <input type="text" class="form-control" id="regUser" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
          <input type="password" class="form-control" id="regPass" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
        <div class="text-center mt-2">
          <a href="#" id="show-login">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆØ±ÙˆØ¯</a>
        </div>
      </form>
    </div>

    <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div id="dashboard">
      <h4 class="mb-3">Ø®Ù„Ø§ØµÙ‡ Ø¨Ø¯Ù‡ÛŒ Ùˆ Ø·Ù„Ø¨ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</h4>
      <div class="row" id="dashboard-cards"></div>
    </div>

    <!-- Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ -->
    <div id="groups" class="d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</h4>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addGroupModal"><i class="fa fa-plus"></i> Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</button>
      </div>
      <div id="group-list" class="list-group"></div>
    </div>

    <!-- Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ -->
    <div id="about-page" class="d-none">
      <div class="card p-4">
        <h4>Ø¯Ø±Ø¨Ø§Ø±Ù‡ PayTogether</h4>
        <p>PayTogether Ù¾Ù„ØªÙØ±Ù…ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ø´ÙØ§Ù Ø¨Ø±Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ… Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ù…ÛŒØ§Ù† Ø¯ÙˆØ³ØªØ§Ù†ØŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ ÛŒØ§ ØªÛŒÙ…â€ŒÙ‡Ø§Ø³Øª.  
          Ø¨Ø§ Ù…Ø§ØŒ Ø¨Ù‡ Ø±Ø§Ø­ØªÛŒ Ø®Ø±Ø¬â€ŒÙ‡Ø§ Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ØŒ Ø³Ù‡Ù… Ù‡Ø± ÙØ±Ø¯ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯ Ùˆ ØªØ³ÙˆÛŒÙ‡â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯.</p>
      </div>
    </div>

    <!-- ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§ -->
    <div id="contact-page" class="d-none">
      <div class="card p-4">
        <h4>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</h4>
        <p>Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÛŒØ§ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…Ø§ Ø¯Ø± ØªÙ…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯:</p>
        <ul>
          <li>Ø§ÛŒÙ…ÛŒÙ„: support@paytogether.ir</li>
          <li>ØªÙ„ÙÙ†: Û°Û²Û±-Û±Û²Û³Û´ÛµÛ¶Û·Û¸</li>
          <li>Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…: <a href="#">@paytogether_ir</a></li>
        </ul>
      </div>
    </div>

  </main>

  <!-- ÙÙˆØªØ± -->
  <footer>
    <div>Â© Û±Û´Û°Û´ PayTogether | ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</div>
  </footer>

  <!-- Modal Ø§ÙØ²ÙˆØ¯Ù† Ú¯Ø±ÙˆÙ‡ -->
  <div class="modal fade" id="addGroupModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</h5></div>
        <div class="modal-body">
          <form id="groupForm">
            <div class="mb-3">
              <label class="form-label">Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡</label>
              <input type="text" class="form-control" id="groupName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Ø§Ø¹Ø¶Ø§ (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)</label>
              <input type="text" class="form-control" id="groupMembers" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÛŒ, Ø±Ø¶Ø§, Ù†Ø±Ú¯Ø³">
            </div>
            <button type="submit" class="btn btn-primary w-100">Ø«Ø¨Øª Ú¯Ø±ÙˆÙ‡</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Ø§Ø¹Ù„Ø§Ù† -->
  <div class="toast-container">
    <div id="mainToast" class="toast align-items-center text-bg-success border-0">
      <div class="d-flex">
        <div class="toast-body" id="toastMsg">Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // === Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ===
  function getUser(){ return JSON.parse(localStorage.getItem('user')||'null'); }
  function setUser(u){ localStorage.setItem('user', JSON.stringify(u)); }
  function logout(){ localStorage.removeItem('user'); location.reload(); }

  $('#logoutBtn').click(()=>{ logout(); });

  // === Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ===
  function loadData(){
    let data = JSON.parse(localStorage.getItem('groups')||'[]');
    if(data.length===0){
      data = [{
        id:1,
        name:'Ø³ÙØ± Ø´Ù…Ø§Ù„',
        members:['Ø¹Ù„ÛŒ','Ø±Ø¶Ø§','Ù†Ø±Ú¯Ø³','Ù…Ø±ÛŒÙ…'],
        expenses:[
          {title:'Ù‡ØªÙ„', amount:800000, payer:'Ø¹Ù„ÛŒ', sharedWith:['Ø±Ø¶Ø§','Ù†Ø±Ú¯Ø³','Ù…Ø±ÛŒÙ…','Ø¹Ù„ÛŒ'], date:dayjs().format('YYYY-MM-DD'), desc:'Ù‡ØªÙ„ Ø±Ø§Ù…Ø³Ø±'},
          {title:'Ø¨Ù†Ø²ÛŒÙ†', amount:400000, payer:'Ø±Ø¶Ø§', sharedWith:['Ø±Ø¶Ø§','Ø¹Ù„ÛŒ'], date:dayjs().format('YYYY-MM-DD'), desc:'Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª'},
        ],
        payments:[]
      }];
      localStorage.setItem('groups', JSON.stringify(data));
    }
    return data;
  }
  function saveData(d){ localStorage.setItem('groups', JSON.stringify(d)); }
  let groups = loadData();

  // === ØªÙˆØ³Øª Ø§Ø¹Ù„Ø§Ù† ===
  const toast = new bootstrap.Toast(document.getElementById('mainToast'));
  function showToast(msg, success=true){
    $('#toastMsg').text(msg);
    $('#mainToast').removeClass('text-bg-danger text-bg-success')
                   .addClass(success?'text-bg-success':'text-bg-danger');
    toast.show();
  }

  // === Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§ ===
  function calculateBalances(group){
    let balance = {};
    group.members.forEach(m=>balance[m]=0);
    group.expenses.forEach(exp=>{
      const share = exp.amount / exp.sharedWith.length;
      exp.sharedWith.forEach(m=>{
        if(m!==exp.payer) balance[m]-=share;
      });
      balance[exp.payer]+=exp.amount - share*(exp.sharedWith.length-1);
    });
    return balance;
  }

  // === Ø±Ù†Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ===
  function renderDashboard(){
    $('#dashboard-cards').empty();
    groups.forEach(g=>{
      const bal = calculateBalances(g);
      const debts = Object.entries(bal).map(([m,v])=>`${m}: ${v.toFixed(0)} ØªÙˆÙ…Ø§Ù†`).join('<br>');
      $('#dashboard-cards').append(`
        <div class="col-md-4">
          <div class="card p-3 mb-3">
            <h5>${g.name}</h5>
            <div class="small text-muted">${debts}</div>
            <button class="btn btn-sm btn-outline-primary mt-2" onclick="showGroup(${g.id})">Ø¬Ø²Ø¦ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡</button>
          </div>
        </div>`);
    });
  }

  // === Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ ===
  function renderGroups(){
    $('#group-list').empty();
    groups.forEach(g=>{
      $('#group-list').append(`
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>${g.name}</strong>
            <div class="small text-muted">${g.members.join(', ')}</div>
          </div>
          <button class="btn btn-sm btn-outline-secondary" onclick="showGroup(${g.id})">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
        </div>`);
    });
  }

  function showGroup(id){
    const g = groups.find(x=>x.id===id);
    alert('Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ú¯Ø±ÙˆÙ‡: '+g.name);
  }

  // === Ø³ÙˆØ¦ÛŒÚ† ØµÙØ­Ø§Øª ===
  function showPage(id){
    $('main > div').addClass('d-none');
    $(id).removeClass('d-none');
    $('.nav-link').removeClass('active');
  }

  $('#nav-dashboard').click(()=>{ showPage('#dashboard'); $('#nav-dashboard').addClass('active'); });
  $('#nav-groups').click(()=>{ showPage('#groups'); $('#nav-groups').addClass('active'); });
  $('#nav-about').click(()=>{ showPage('#about-page'); $('#nav-about').addClass('active'); });
  $('#nav-contact').click(()=>{ showPage('#contact-page'); $('#nav-contact').addClass('active'); });
  $('#nav-home').click(()=>{ showPage('#dashboard'); });

  // === ÙØ±Ù… Ú¯Ø±ÙˆÙ‡ ===
  $('#groupForm').on('submit', e=>{
    e.preventDefault();
    const name = $('#groupName').val().trim();
    const members = $('#groupMembers').val().split(',').map(x=>x.trim()).filter(x=>x);
    const newGroup = { id: Date.now(), name, members, expenses:[], payments:[] };
    groups.push(newGroup);
    saveData(groups);
    renderGroups();
    $('#addGroupModal').modal('hide');
    showToast('Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.');
  });

  // === ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… ===
  $('#show-register').click(()=>{ $('#login-page').addClass('d-none'); $('#register-page').removeClass('d-none'); });
  $('#show-login').click(()=>{ $('#register-page').addClass('d-none'); $('#login-page').removeClass('d-none'); });

  $('#loginForm').submit(e=>{
    e.preventDefault();
    const user = $('#loginUser').val();
    const pass = $('#loginPass').val();
    const reg = JSON.parse(localStorage.getItem('registeredUsers')||'{}');
    if(reg[user] && reg[user]===pass){
      setUser({user});
      showToast('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯');
      location.reload();
    } else showToast('Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', false);
  });

  $('#registerForm').submit(e=>{
    e.preventDefault();
    const user = $('#regUser').val();
    const pass = $('#regPass').val();
    let reg = JSON.parse(localStorage.getItem('registeredUsers')||'{}');
    if(reg[user]) return showToast('Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯', false);
    reg[user]=pass;
    localStorage.setItem('registeredUsers', JSON.stringify(reg));
    showToast('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ú©Ù†ÙˆÙ† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
    $('#register-page').addClass('d-none');
    $('#login-page').removeClass('d-none');
  });

  // === Ø´Ø±ÙˆØ¹ ===
  $(document).ready(()=>{
    const u = getUser();
    if(!u){
      showPage('#login-page');
    } else {
      renderDashboard();
      renderGroups();
      showPage('#dashboard');
    }
  });
  </script>

  <!-- TODO Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ:
  - Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ú¯Ø±ÙˆÙ‡ Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø²ÛŒÙ†Ù‡
  - Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… ØªØ³ÙˆÛŒÙ‡ Ú©Ù…ÛŒÙ†Ù‡ (greedy)
  - OCR Ø±Ø³ÛŒØ¯Ù‡Ø§ Ø¨Ø§ Tesseract.js
  - Ø§ØªØµØ§Ù„ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù‚Ø¹ÛŒ -->
</body>
</html>
